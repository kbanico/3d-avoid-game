<html>
  <head>
    <script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/0.6.1/aframe-master.min.js"></script>
  </head>
  <body>
    <a-scene>
       <a-assets>
           <img src="images/tron-ground.png" id="ground">
           <img src="images/building.png" id="building1">
           <img src="images/building2.png" id="building2">
           <img src="images/matrix.png" id="matrix">
           <img src="images/yellow.jpg" id="yellow">
       </a-assets>
       
        <a-sky color="#000"></a-sky>
       
        
        <a-plane rotation="-90 0 0" width="100" height="1000" src="#ground" repeat="4 50"></a-plane>
<!--        <a-plane rotation="-90 0 0" width="100" height="100" color="#a3d97d" repeat="4 4"></a-plane>-->
       
       <a-plane transparent ="true" width="1000" height="1000" src="#matrix" position="0 50 0" side="double" repeat="10 10" rotation="-90 0 0"></a-plane>
        
        
        
        <a-camera position="0 0 50" wasd-controls="acceleration:1000">
            <a-cursor></a-cursor>
        </a-camera>
    </a-scene>
    
    <script>
        
      var camera = document.querySelector("a-camera")
      var scene = document.querySelector("a-scene")
      var moveLeft = false;
      var moveRight = false;
      var startMoving = true;
      var leftXCheck = -40;
      var rightXCheck = 40;
      var enemies = [];
      var colors = ["#bf3eff","#ddcec4","#aa99ae","#b40000","#cb9b37","#98877b","#a998ae","#c3e198","#f2f1e7"]
      var minDistance = 1;
      
      
        
      window.onload=function(){
      
          addEnemies();
          

          
          var update = setInterval(function(){
            cameraEdgeCheck();
            moveCamera()
              
            //start moving
            if(startMoving){
                current = getCameraPosition();
                if(moveLeft){
                    console.log("true")
                    setCameraPosition(current.x-=0.8,current.y,current.z)
                }
                if(moveRight){
                    console.log("true")
                    setCameraPosition(current.x+=0.8,current.y,current.z)
                }
                setCameraPosition(current.x,current.y,current.z-=0.8)
            }
              
              
            
            //collision
            enemies.forEach(function(enemy){
                camera = document.querySelector("a-camera")
                checkCollision(camera,enemy)

              })
            
            
          },60)
          
              
      }
      
      
      
      //functions
      var getCameraRotation = function(){
          //console.log(camera.getAttribute("rotation"))
          return rotation=camera.getAttribute("rotation")
          
          }
      
      var getCameraPosition = function(){
          return position = camera.getAttribute("position")
      }
      
      
      
      var moveCamera = function(){
          rotation = getCameraRotation();
          if(rotation.y >= 20){
              moveLeft = true;
          }else{
              moveLeft = false;
          }
          
          if(rotation.y <= -20){
              moveRight = true;
          }else{
              moveRight = false;
          }
      }
      
      
      
      var setCameraPosition = function(x = 0,y = 0,z = 0){
          camera.setAttribute("position",{x:x,y:y,z:z})
      }
      
      var cameraEdgeCheck = function(){
          if(getCameraPosition().x <= leftXCheck){
              //console.log("over")
              var currentPosition = getCameraPosition()
              setCameraPosition(0,currentPosition.y,currentPosition.z)
          }
          
          if(getCameraPosition().x >= rightXCheck){
              //console.log("over")
              var currentPosition = getCameraPosition()
              setCameraPosition(0,currentPosition.y,currentPosition.z)
          }
      }
      
      var addEnemies = function(){
          for(var i = 0; i < 100; i++){
              var enemy = document.createElement("a-box");
              enemy.setAttribute("color",colors[Math.floor(Math.random()* colors.length)])
              enemy.setAttribute("position",{x:Math.floor(Math.random() * 40) * (Math.random() <= 0.5 ? 1 : -1),y:1, z:i * (-3)})
              enemy.setAttribute("width",Math.floor(Math.random()*5) + 1)
              enemy.setAttribute("height",Math.floor(Math.random()*10) +4 )
              enemy.setAttribute("src","#building" + Math.floor(Math.random()*2 + 1) )
              enemies.push(enemy)
              scene.appendChild(enemy)
          }
      }
      
      var checkCollision = function(player,object){
          var playerPosition = player.getAttribute("position");
          var objectPosition = object.getAttribute("position");
          var xDiff = Math.abs(playerPosition.x - objectPosition.x)
          var zDiff = Math.abs(playerPosition.z - objectPosition.z)
          
          if(xDiff <= minDistance && zDiff <= minDistance){
              //console.log("collided")
              startMoving = false
          }
      }
      
      
    
    </script>
  </body>
</html>